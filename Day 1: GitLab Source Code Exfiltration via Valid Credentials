# *Alert Title*
GitLab Source Code Exfiltration via Valid Credentials

## **Description**
This query detects potential source‑code exfiltration following a successful GitLab authentication, a technique commonly seen in supply‑chain and third‑party vendor breaches. It correlates successful GitLab sign‑ins—including vendor, contractor, or third‑party accounts—with large outbound data transfers exceeding **1 GB** from the same IP address within a one‑hour window.

This behaviour mirrors the December 2025 Nissan vendor GitLab breach, where attackers used valid vendor credentials to authenticate and exfiltrate source code without deploying malware.  

By focusing on **behavioural sequencing** instead of IOCs, this analytic helps identify:
- Compromised vendor or service accounts  
- Unauthorized repository cloning or bulk export activity  
- Exfiltration over legitimate encrypted channels  

This makes it especially effective for detecting **TTP‑based intrusions** that bypass traditional signature‑based defences.

## **Threats**
■ **Crimson Collective**  
■ **ShinyHunters**

## **MITRE ATT&CK Techniques**

### **Tactics**
■ Initial Access  
■ Persistence  
■ Exfiltration  

### **Techniques**
■ **T1078 – Valid Accounts**  
■ **T1567.002 – Exfiltration to Cloud Storage**  
■ **T1041 – Exfiltration Over C2 Channel**

## **Severity**
**High**

## **Detection Type**
■ Threat Hunting  
■ Behavioural Detection  
■ TTP‑based  

## **Data Sources**
### **Microsoft Sentinel**
■ **Microsoft Entra ID**: `SigninLogs`  
■ **CommonSecurityLog`** (Firewall / Proxy logs)

## **False Positives**
■ Legitimate developers performing authorised large repository clones  
■ Automated CI/CD pipelines or build agents  
■ Scheduled backups or artifact distribution tasks  

## **Query**

```kusto

 -------------------------------
// GitLab login + large outbound transfer correlation
// -------------------------------

// Subquery: Successful GitLab sign-ins from Entra ID SigninLogs
let GitLabLogins =
    SigninLogs
    // Filter to GitLab application logins (adjust if you use self-hosted GitLab with a different AppDisplayName)
    | where AppDisplayName has "GitLab"
    // Only successful sign-ins (ResultType == 0 means success)
    | where ResultType == 0
    // Keep only fields needed for the join and final projection
    | project UserPrincipalName, IPAddress, TimeGenerated, AppDisplayName;

// Subquery: Large outbound transfers from firewall/proxy telemetry (CommonSecurityLog)
// NOTE: Field names vary by vendor; ensure 'SentBytes' exists for your connector.
// Many vendors use bytes_out/outBytes, etc. Adjust if needed.
let NetworkExfil =
    CommonSecurityLog
    // Compute human-readable GB value for triage (rounded to 2 decimals)
    | extend SentGB = round(SentBytes / 1024.0 / 1024.0 / 1024.0, 2)
    // Threshold: transfers greater than 1 GB (adjust to your environment and noise tolerance)
    | where SentGB > 1
    // Exclude denied/blocked actions to focus on successful egress
    | where DeviceAction !in~ ("deny", "blocked")
    // Keep network evidence fields for correlation and triage
    | project SourceIP, DestinationIP, DestinationPort, TimeGenerated, SentBytes, SentGB, RequestURL;

// Correlate GitLab successful sign-ins with large outbound transfers
GitLabLogins
| join kind=inner (
    NetworkExfil
    // Align join key: match SigninLogs IPAddress to proxy/firewall SourceIP (public egress in most cases)
    // If your environment uses NAT or different IP semantics, consider enriching with device/user mapping.
    | project IPAddress = tostring(SourceIP),
              TimeGenerated,
              SentBytes,
              SentGB,
              RequestURL,
              DestinationIP,
              DestinationPort
) on IPAddress
// Time-window correlation: network event occurs within 1 hour of the login
// After join, right-side duplicate columns are suffixed with '1' (TimeGenerated1 here).
| where TimeGenerated1 between (TimeGenerated .. TimeGenerated + 1h)
// Final evidence set for the alert/investigation
| project UserPrincipalName,
          IPAddress,
          LoginTime = TimeGenerated,
          ExfilTime = TimeGenerated1,
          SentGB,
          RequestURL,
          DestinationIP,
          DestinationPort,
          AppDisplayName
```

## **References**
■ Santhanam, A. (2025). *Red Hat Data Breach Exposes 21,000+ Nissan Customer Records.* Medium.  
  https://cybersecuritywriteups.com/red-hat-data-breach-exposes-21-000-nissan-customer-records-dd93eb2a35a3  
■ SOCRadar (2025). *Dark Web Profile: ShinyHunters.*  
  https://socradar.io/blog/dark-web-profile-shinyhunters/

## **Author**
**Faiza Aslam**
